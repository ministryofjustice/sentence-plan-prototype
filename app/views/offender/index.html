{% extends "layout.html" %}

{% block afterHeader %}
  {% include "includes/key-details.html" %}
{% endblock %}

{% block content %}
  <div class="govuk-grid-row">
    {# <div class="govuk-grid-column-full">

       <div class="case-header">
        <h1 class="govuk-heading-l govuk-!-margin-bottom-0">
          <span class="govuk-caption-l">Offender's name</span>
          {{ offender.firstname }} {{ offender.lastname }}
        </h1>

        <dl class="case-header__details">
          <dt class="/govuk-visually-hidden">
            CRN number:
          </dt>
          <dd>
            {{ offender.crn }}
          </dd>

          <dt>
            NOMS number:
          </dt>
          <dd>
            {{ offender.noms }}
          </dd>
          
          <dt>
            Keyworker:
          </dt>
          <dd>
            {{ offender.keyworker }}
          </dd>
        </dl>
      </div>

    </div> #}





    <div class="govuk-grid-column-full">

      {% if planSaved %}
        {{ mojBanner({
          type: 'success',
          text: planSaved,
          iconFallbackText: 'Success'
        }) }} 
      {% endif %}

      <h1 class="govuk-visually-hidden">
        Offender plans: {{ offender.name }}
      </h1>

      <div class="moj-page-header-actions"">
        <div class="moj-page-header-actions__title">
          <h1 class="govuk-heading-l">
            Active plan
          </h1>
        </div>

        {% if data['answers-checked'] %}
        <div class="moj-page-header-actions__actions">
          <div class="moj-button-menu">
            <div class="moj-button-menu__wrapper">

              {# <div style="float: right;">
                {{ mojButtonMenu({
                items: [{
                  text: "First action",
                  href: "#"
                }, {
                  text: "Second action",
                  href: "#",
                  classes: "govuk-button--secondary"
                }, {
                  text: "Third action",
                  href: "#",
                  classes: "govuk-button--secondary"
                }]
                }) }}
              </div>  #}

              {{ govukButton ({
                text: 'Close plan',
                href: '/offender/close',
                classes: 'govuk-button--secondary moj-button-menu__item moj-page-header-actions__action'
              }) }}

              {{ govukButton ({
                text: 'Print',
                href: '/offender/print/',
                classes: 'govuk-button--secondary moj-button-menu__item moj-page-header-actions__action'
              }) }}

            </div>
          </div>
        </div>
        {% endif %}
      </div> 
    {# </div>
    <div class="govuk-grid-column-two-thirds"> #}
      {% if data['answers-checked'] %}
        <h3 class="govuk-heading-m">
          Summary
        </h3>

        <dl class="govuk-summary-list / govuk-!-margin-bottom-3">
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              {{ offender.firstname }}&rsquo;s summary
            </dt>
            <dd class="govuk-summary-list__value">
              {{ data['offender-summary'] | nl2br | safe }}
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Goal
            </dt>
            <dd class="govuk-summary-list__value">
              {{ data['goal'] | nl2br | safe }}
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Notes
            </dt>
            <dd class="govuk-summary-list__value">
              {{ data['notes'] | nl2br | safe }}
            </dd>
          </div>
          {# <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Motivations
            </dt>
            <dd class="govuk-summary-list__value">
              <ul class="govuk-list govuk-list--bullet">
                {% for need in offender.needs %}
                  <li>
                    {{ need.type }}: 
                    {{ data["motivation-"+loop.index] }}
                  </li>
                {% endfor %}
              </ul>
            </dd>
          </div> #}
          {% if data['comment-added'] == "true" %}
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Comment <br><span class="govuk-!-font-weight-regular">({{ moment | date("D MMMM YYYY") }})</span>
            </dt>
            <dd class="govuk-summary-list__value">
              {% if data['offender-comment'] %}
              <p><strong>{{ offender.firstname }}&rsquo;s words:</strong><br>{{ data['offender-comment'] | nl2br | safe }}</p>
              {% endif %}

              {% if data['practitioner-comment'] %}
              <p><strong>Practitioner&rsquo;s words:</strong><br>{{ data['practitioner-comment'] | nl2br | safe }}</p>
              {% endif %}
              <p>
            </dd>
          </div>
          {% endif %}
        </dl>
        <p><a class="govuk-link govuk-link--no-visited-state" href="/offender/comment">Add a comment</a></p>


        <hr class="govuk-section-break govuk-section-break--xl">



        <h3 class="govuk-heading-m">
          Steps
        </h3>

        <div class="filters">
          {{ govukCheckboxes ({
            idPrefix: 'js-toggle',
            name: 'show-complete',
            classes: 'govuk-checkboxes--small',
            items: [
            {
              text: 'Show completed steps',
              value: 'Show completed steps'
            }
            ]
          }) }}

          <div class="govuk-form-group">
            <label class="govuk-label" for="sort">
              Show need:
            </label>


            <select class="govuk-select" id="sort" name="sort">
            <option value="All">All</option>
            {% for need in offender.needs %}
              <option value="{{ need.type }}">{{ need.type }}</option>
            {% endfor %}
            </select>
          </div>
        </div>


{% set dueDate1 = data['step-date-year'] + "-" + data['step-date-month'] + "-" + data['step-date-day'] %}
{% set dueDate2 = data['step-date-2-year'] + "-" + data['step-date-2-month'] + "-" + data['step-date-2-day'] %}

        <ul class="govuk-list govuk-!-margin-bottom-3">
          <li>
            <a href="/offender/step/1" class="task">
              <span class="task__heading">
                {{ data['intervention-type'] if data['step-intervention'] == 'Yes' else data['step-description']  }}
              </span>

              {{ data['status'] }} &middot; Due by {{ dueDate | date("D MMMM YYYY") }}
              <ul class="govuk-list list-tags">
                <li class="govuk-!-font-weight-bold">Needs:</li>
                {% for need in data['step-needs'] %}
                  <li class="tag">{{ need }}</li>
                {% endfor %}
              </ul>
            </a>
          </li>

          {% if data['step-2-added'] == 'true' %}
          <li>
            <a href="/offender/step/2" class="task">
              <span class="task__heading">
                {{ data['intervention-type-2'] if data['step-intervention-2'] == 'Yes' else data['step-description-2']  }}
              </span>


              {{ data['status-2'] }} &middot; Due by {{ dueDate2 | date("D MMMM YYYY") }}
              <ul class="govuk-list list-tags">
                <li class="govuk-!-font-weight-bold">Needs:</li>
                {% for need in data['step-needs-2'] %}
                  <li class="tag">{{ need }}</li>
                {% endfor %}
              </ul>
            </a>
          </li>
          {% endif %}

 


          <li class="js-hidden">
            <a href="#0" class="task task--complete">
              <span class="task__heading">
                Attend alcohol awareness course.
              </span>
              Complete Â· Last updated on {{ moment | date("subtract", 15, "days") | date("D MMMM YYYY") }}
              <ul class="govuk-list list-tags">
                <li class="govuk-!-font-weight-bold">Needs:</li>
                <li>Alcohol misuse</li>
              </ul>
            </a>
          </li>
        </ul>
        <p><a class="govuk-link govuk-link--no-visited-state" href="#0">Add a step</a></p>




      {% else %}
        <p>There is no active plan.</p>
        {{ govukButton ({
          text: 'Start a new plan',
          href: '/offender/create-plan/summary'
        }) }}
      {% endif %}




      <hr class="govuk-section-break section-break-large">


      <h2 class="govuk-heading-m">
        Previous plans
      </h2>

      <ul class="govuk-list">
        {% if data['plan-closed'] %}
        <li>
          <a class="govuk-link" href="#">Plan closed {{ moment | date("D MMMM YYYY") }}</a>
        </li>
        {% endif %}
        <li>
          <a class="govuk-link" href="#">Plan closed {{ moment | date("subtract", 100, "days") | date("D MMMM YYYY") }}</a>
        </li>
        <li>
          <a class="govuk-link" href="#">Plan closed {{ moment | date("subtract", 211, "days") | date("D MMMM YYYY") }}</a>
        </li>
      </ul>





      {# <h2 class="govuk-heading-m">
        Summary
      </h2>

      <dl class="govuk-summary-list /govuk-summary-list--no-border">
        {% for item in offender.summary %}
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              {{ item.title }}
            </dt>
            <dd class="govuk-summary-list__value">
              {{ item.value }}
            </dd>
          </div>
        {% endfor %}
      </dl> #}

    </div>
  </div>
{% endblock %}
