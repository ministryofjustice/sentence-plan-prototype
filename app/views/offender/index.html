{% extends "layout.html" %}

{% block afterHeader %}
  {% include "includes/key-details.html" %}
{% endblock %}

{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">

      {% if planSaved %}
        {{ mojBanner({
          type: 'success',
          text: planSaved,
          iconFallbackText: 'Success'
        }) }} 
      {% endif %}

      <h1 class="govuk-visually-hidden">
        Offender plans: {{ offender.name }}
      </h1>

      <div class="moj-page-header-actions"">
        <div class="moj-page-header-actions__title">
          <h1 class="govuk-heading-l">
            Active plan
          </h1>
        </div>



        {% if not data['plan-status'] %}
      </div>
          <p>There is no active plan.</p>
          {{ govukButton ({
            text: 'Start a new plan',
            href: '/offender/create-plan/summary'
          }) }}



        {% elif data['plan-status'] == 'draft' %}

      </div> 
          <p>There is a draft plan.</p>
          {{ govukButton ({
            text: 'View draft',
            href: '/offender/create-plan/check-your-answers'
          }) }}




        {% elif data['plan-status'] == 'saved' %}

        <div class="moj-page-header-actions__actions">
          <div class="moj-button-menu">
            <div class="moj-button-menu__wrapper">

              {{ govukButton ({
                text: 'Close plan',
                href: '/offender/close',
                classes: 'govuk-button--secondary moj-button-menu__item moj-page-header-actions__action'
              }) }}

              {{ govukButton ({
                text: 'Print',
                href: '/offender/print/',
                classes: 'govuk-button--secondary moj-button-menu__item moj-page-header-actions__action'
              }) }}

            </div>
          </div>
        </div>
      </div> 

    {# </div>
    <div class="govuk-grid-column-two-thirds"> #}


        <h3 class="govuk-heading-m govuk-visually-hidden">
          Plan summary
        </h3>

        <dl class="govuk-summary-list govuk-!-margin-bottom-9">
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Diversity
            </dt>
            <dd class="govuk-summary-list__value">
              {{ data['diversity'] | nl2br | safe }}
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Their summary
            </dt>
            <dd class="govuk-summary-list__value">
              {{ data['offender-summary'] | nl2br | safe }}
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Practitioner&rsquo;s comments on plan
            </dt>
            <dd class="govuk-summary-list__value">
              {{ data['practitioner-comment'] | nl2br | safe }}
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Their comments on plan
            </dt>
            <dd class="govuk-summary-list__value">
              {{ data['offender-comment'] | nl2br | safe }}
            </dd>
          </div>
        </dl>



        <h3 class="govuk-heading-m govuk-!-margin-bottom-1">
          Goals
        </h3>

        <div class="filters govuk-!-margin-bottom-4">
          {{ govukCheckboxes ({
            idPrefix: 'js-toggle',
            name: 'show-complete',
            classes: 'govuk-checkboxes--small',
            items: [
            {
              text: 'Show completed goals',
              value: 'Show completed goals'
            }
            ]
          }) }}

          {# <div class="govuk-form-group">
            <label class="govuk-label" for="sort">
              Show need:
            </label>


            <select class="govuk-select" id="sort" name="sort">
            <option value="All">All</option>
            {% for need in offender.needs %}
              <option value="{{ need.type }}">{{ need.type }}</option>
            {% endfor %}
            </select>
          </div> #}
        </div>




        {# <ul class="govuk-list">
          {% if data['goals-reordered'] == 'true' %}
            {% include "includes/goal2-card.html" %}
            {% include "includes/goal1-card.html" %}
          {% else %} 
            {% include "includes/goal1-card.html" %}
            
            {% if data['goal2-added'] == 'true' %}
              {% include "includes/goal2-card.html" %}
            {% endif %}
          {% endif %}
        </ul> #}

        <ol class="app-task-list">
          <li>
            <h3 class="app-task-list__section govuk-!-font-size-19">
              {{ data['goal1-description'] | nl2br | safe }}
            </h3>
            <p class="govuk-body-s"><strong>Needs and motivations</strong>: {% for need in data['goal1-needs'] %}{{ need | replace(" – <span class='risk'>Risk of serious harm</span>", "") }} ({{ data["goal1-motivation"+loop.index] }}){% endfor %}</p>

            <ul class="app-task-list__items">
              <li class="app-task-list__item">
                <span class="app-task-list__task-name">
                  <a class="govuk-link--no-visited-state" href="/offender/steps/step?step=goal1-step1">
                    {% if data['goal1-step1-intervention'] == 'Yes' %}
                      Intervention: {{ data['goal1-step1-intervention-type'] }}
                    {% else %}
                      {{ data['goal1-step1-description'] }}
                    {% endif %}
                  </a>
                </span>
                {% if data['goal1-step1-status'] %}
                  <strong class="govuk-tag app-task-list__task-completed {{ 'moj-tag--grey' if data['goal1-step1-status'] == 'In progress' or data['goal1-step1-status'] == 'Paused' }}">{{ data['goal1-step1-status'] }}</strong>
                {% endif %}
              </li>

              {% if data['goal1-step2-added'] == 'true' %}
              <li class="app-task-list__item">
                <span class="app-task-list__task-name">
                  <a class="govuk-link--no-visited-state" href="/offender/steps/step?step=goal1-step2">
                    {% if data['goal1-step2-intervention'] == 'Yes' %}
                      Intervention: {{ data['goal1-step2-intervention-type'] }}
                    {% else %}
                      {{ data['goal1-step2-description'] }}
                    {% endif %}
                  </a>
                </span>
                {% if data['goal1-step2-status'] %}
                  <strong class="govuk-tag app-task-list__task-completed {{ 'moj-tag--grey' if data['goal1-step2-status'] == 'In progress' or data['goal1-step2-status'] == 'Paused' }}">{{ data['goal1-step2-status'] }}</strong>
                {% endif %}
              </li>
              {% endif %}
            </ul>
          </li>

          {% if data['goal2-added'] == 'true' %}
          <li>
            <h3 class="app-task-list__section govuk-!-font-size-19">
              {{ data['goal2-description'] | nl2br | safe }}
            </h3>
            <p class="govuk-body-s"><strong>Needs and motivations</strong>: {% for need in data['goal2-needs'] %}{{ need | replace(" – <span class='risk'>Risk of serious harm</span>", "") }} ({{ data["goal2-motivation"+loop.index] }}){% endfor %}</p>

            <ul class="app-task-list__items">
              <li class="app-task-list__item">
                <span class="app-task-list__task-name">
                  <a class="govuk-link--no-visited-state" href="/offender/steps/step?step=goal2-step1">
                    {% if data['goal2-step1-intervention'] == 'Yes' %}
                      Intervention: {{ data['goal2-step1-intervention-type'] }}
                    {% else %}
                      {{ data['goal2-step1-description'] }}
                    {% endif %}
                  </a>
                </span>
                {% if data['goal2-step1-status'] %}
                  <strong class="govuk-tag app-task-list__task-completed {{ 'moj-tag--grey' if data['goal2-step1-status'] == 'In progress' or data['goal2-step1-status'] == 'Paused' }}">{{ data['goal2-step1-status'] }}</strong>
                {% endif %}
              </li>
              
              {% if data['goal2-step2-added'] == 'true' %}
              <li class="app-task-list__item">
                <span class="app-task-list__task-name">
                  <a class="govuk-link--no-visited-state" href="/offender/steps/step?step=goal2-step2">
                    {% if data['goal2-step2-intervention'] == 'Yes' %}
                      Intervention: {{ data['goal2-step2-intervention-type'] }}
                    {% else %}
                      {{ data['goal2-step2-description'] }}
                    {% endif %}
                  </a>
                </span>
                {% if data['goal2-step2-status'] %}
                  <strong class="govuk-tag app-task-list__task-completed {{ 'moj-tag--grey' if data['goal2-step2-status'] == 'In progress' or data['goal2-step2-status'] == 'Paused' }}">{{ data['goal2-step2-status'] }}</strong>
                {% endif %}
              </li>
              {% endif %}
            </ul>
          </li>
          {% endif %}


          <li class="js-hidden">
            <h3 class="app-task-list__section govuk-!-font-size-19">
              An example goal which has been completed
            </h3>
            <ul class="app-task-list__items">
              <li class="app-task-list__item">
                <span class="app-task-list__task-name">
                  <a class="govuk-link--no-visited-state" href="#">
                    {% if data['goal2-step1-intervention'] == 'Yes' %}
                      Intervention: {{ data['goal2-step1-intervention-type'] }}
                    {% else %}
                      {{ data['goal2-step1-description'] }}
                    {% endif %}
                  </a>
                </span>
                <strong class="govuk-tag app-task-list__task-completed">Completed</strong>
              </li>
              
              {% if data['goal2-step2-added'] == 'true' %}
              <li class="app-task-list__item">
                <span class="app-task-list__task-name">
                  <a class="govuk-link--no-visited-state" href="#">
                    {% if data['goal2-step2-intervention'] == 'Yes' %}
                      Intervention: {{ data['goal2-step2-intervention-type'] }}
                    {% else %}
                      {{ data['goal2-step2-description'] }}
                    {% endif %}
                  </a>
                </span>
                <strong class="govuk-tag app-task-list__task-completed">Completed</strong>
              </li>
              {% endif %}
            </ul>
          </li>
        </ol>


        {{ govukButton ({
          text: 'Add another goal',
          href: '#0',
          classes: 'govuk-button--secondary govuk-!-margin-bottom-3'
        }) }}
        {% if data['goal2-added'] %}
          {{ govukButton ({
            text: 'Reorder goals',
            href: '#0',
            classes: 'govuk-button--secondary govuk-!-margin-bottom-3'
          }) }}
        {% endif %}

        

        

      {% endif %} {# plan status #}




      <hr class="govuk-section-break section-break-large">


      <h2 class="govuk-heading-m">
        Previous plans
      </h2>

      <ul class="govuk-list">
        {% if data['plan-closed'] %}
        <li>
          <a class="govuk-link" href="#">Plan closed {{ moment | date("D MMMM YYYY") }}</a>
        </li>
        {% endif %}
        <li>
          <a class="govuk-link" href="#">Plan closed {{ moment | date("subtract", 100, "days") | date("D MMMM YYYY") }}</a>
        </li>
        <li>
          <a class="govuk-link" href="#">Plan closed {{ moment | date("subtract", 211, "days") | date("D MMMM YYYY") }}</a>
        </li>
      </ul>


    </div>
  </div>
{% endblock %}
